---
name: plan-mode-methodology
description: Plan Mode 的標準工作方法論，確保技術決策基於可靠資訊而非假設
priority: high
enforcement: strict
---

# Plan Mode 標準工作方法論

## 🎯 核心原則

**在 Plan Mode 中，可靠資訊優先於推理猜測**

### 資訊來源可靠性排序
1. **官方文檔**（透過 MCP 查詢）- 最高優先級 ⭐
2. AWS 服務文檔和最佳實踐
3. 專案現有代碼
4. 個人技術知識和推理

---

## 📋 強制性工作流程

### Phase 1: 資訊收集（Information Gathering）

遇到以下情況時，**必須**使用 MCP 查詢官方文檔：

#### 觸發條件
- [ ] 用戶詢問「X 功能做得到嗎？」
- [ ] 需要整合新的 AWS 服務或技術
- [ ] 對某技術能力不完全確定
- [ ] 設計涉及多個服務的架構
- [ ] 評估不同實現方案的可行性

#### 必須執行的步驟

1. **立即使用 MCP 查詢**
   ```
   use_mcp_tool → aws___search_documentation
   - 查詢相關技術能力
   - 確認支援的功能
   - 了解限制條件
   ```

2. **查詢策略**
   - 先寬泛查詢：了解整體能力
   - 再具體查詢：確認實現細節
   - 最後查詢最佳實踐：參考推薦做法

3. **閱讀相關代碼**
   ```
   read_file → 查看專案現有實現
   - 理解當前架構
   - 識別整合點
   - 發現可能的限制
   ```

4. **對比與驗證**
   - 對比官方文檔與現有代碼
   - 驗證假設是否正確
   - 識別潛在的不一致

---

### Phase 2: 方案設計（Solution Design）

#### 必須基於已驗證的事實

**❌ 禁止的做法**
```
「根據現有代碼模式，我推測應該...」
「通常這種情況下會使用...」
「我認為這個框架應該支援...」
```

**✅ 正確的做法**
```
「根據 AWS 官方文檔 [URL]，確認支援...」
「文檔指出最佳實踐是...」
「官方範例展示了...」
```

#### 方案評估標準
1. **官方推薦** - 是否符合 AWS 最佳實踐？
2. **架構一致性** - 是否符合專案現有架構？
3. **可維護性** - 未來是否容易維護？
4. **完整性** - 是否考慮了所有整合點？

---

### Phase 3: 計劃呈現（Plan Presentation）

#### 必須包含的內容

1. **資訊來源**
   - 引用查詢的官方文檔
   - 說明驗證過程
   - 列出關鍵發現

2. **技術確認**
   - 明確說明「已確認支援」vs「假設支援」
   - 列出官方限制條件
   - 說明為什麼選擇此方案

3. **實施計劃**
   - 詳細步驟
   - 風險評估
   - 驗證點

---

## 🚫 絕對禁止的行為

### 1. 跳過 MCP 查詢就提出技術方案

**錯誤示例**：
```
用戶：「X 功能做得到嗎？」
AI：「可以！我們這樣實現...」[未查詢文檔]
```

**正確做法**：
```
用戶：「X 功能做得到嗎？」
AI：use_mcp_tool → 查詢官方文檔
AI：「根據官方文檔，確認支援...」
```

### 2. 基於代碼模式推理未驗證的能力

**錯誤示例**：
```
「現有代碼使用 Code Interpreter，
 所以圖片應該也用 Code Interpreter」
```

**正確做法**：
```
「讓我查詢 Strands Agent 是否原生支援圖片...」
[查詢後] 「文檔確認 Strands 支援多模態輸入」
```

### 3. 提出「繞過架構」的方案而未先驗證架構能力

**錯誤示例**：
```
「Agent 可能不支援圖片，我們繞過 Agent...」
```

**正確做法**：
```
「讓我先確認 Agent 的多模態能力...」
[查詢後決定方案]
```

---

## ✅ 檢查清單

在提出技術方案前，確認：

### 資訊收集
- [ ] 已使用 MCP 查詢相關 AWS 服務文檔
- [ ] 已查詢框架/工具的官方文檔
- [ ] 已閱讀專案相關代碼
- [ ] 已識別所有技術限制

### 方案設計
- [ ] 方案基於已驗證的事實
- [ ] 引用了官方文檔支持
- [ ] 考慮了架構一致性
- [ ] 評估了多種方案

### 計劃呈現
- [ ] 說明了資訊來源
- [ ] 解釋了選擇理由
- [ ] 列出了實施步驟
- [ ] 識別了潛在風險

---

## 📖 實例：正確的工作流程

### 場景：用戶問「圖片分析功能做得到嗎？」

```
Step 1: 觸發 MCP 查詢
├─ use_mcp_tool: "Strands multimodal support"
├─ use_mcp_tool: "Claude vision API"
└─ use_mcp_tool: "BedrockModel image input"

Step 2: 閱讀相關代碼
├─ read_file: conversation_agent.py
├─ read_file: processor_entry.py
└─ read_file: file_service.py

Step 3: 驗證與對比
├─ 官方文檔：Strands 支援多模態 ✓
├─ 現有代碼：使用 Strands Agent ✓
└─ 結論：可以直接整合

Step 4: 設計方案
├─ 方案：基於 Agent 架構
├─ 理由：官方確認支援 + 保持架構一致
└─ 優勢：Memory、Tools 都能用

Step 5: 呈現計劃
└─ 說明查詢結果 + 實施步驟
```

---

## 🎯 期望結果

遵循此規則後，應該達到：

1. **更快找到正確方案**
   - 直接查詢官方文檔，避免繞路

2. **更高的方案質量**
   - 基於事實而非猜測
   - 符合官方最佳實踐

3. **更好的可維護性**
   - 方案符合現有架構
   - 未來更容易演進

4. **更明確的決策過程**
   - 清楚記錄資訊來源
   - 方便未來參考

---

## ⚠️ 違反規則的後果

如果跳過 MCP 查詢：
- 可能提出不可行的方案
- 可能錯過更好的解決方式
- 可能破壞現有架構
- 浪費實施時間

---

## 🔄 持續改進

此規則應該：
- 根據經驗持續更新
- 添加新的最佳實踐
- 記錄常見錯誤模式
- 優化工作流程

---

**規則版本**: v1.0  
**創建日期**: 2026-01-07  
**基於案例**: 圖片分析功能規劃的教訓  
**維護者**: AgentCoreNexus Team
