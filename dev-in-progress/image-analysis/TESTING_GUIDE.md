# åœ–ç‰‡åˆ†æåŠŸèƒ½æ¸¬è©¦æŒ‡å—

## ğŸ§ª æ¸¬è©¦æº–å‚™

### å‰ç½®æ¢ä»¶
- [x] ä»£ç¢¼èªæ³•æª¢æŸ¥é€šé
- [ ] SAM éƒ¨ç½²å®Œæˆ
- [ ] Lambda å‡½æ•¸ç‹€æ…‹æ­£å¸¸
- [ ] Telegram webhook å·²è¨­ç½®

## ğŸ“‹ æ¸¬è©¦å ´æ™¯

### å ´æ™¯ 1: åŸºç¤åœ–ç‰‡æè¿°

**æ¸¬è©¦æ­¥é©Ÿ**ï¼š
1. åœ¨ Telegram ä¸Šå‚³ä¸€å¼µé¢¨æ™¯ç…§
2. ä¸æ·»åŠ ä»»ä½•æ–‡å­—èªªæ˜

**é æœŸçµæœ**ï¼š
```
Bot: é€™æ˜¯ä¸€å¼µ[è©³ç´°çš„åœ–ç‰‡æè¿°]...
```

**é©—è­‰é»**ï¼š
- âœ… Bot èƒ½æ”¶åˆ°ä¸¦è™•ç†åœ–ç‰‡
- âœ… å›æ‡‰ç‚ºä¸­æ–‡
- âœ… æè¿°æº–ç¢ºä¸”è©³ç´°

---

### å ´æ™¯ 2: å¸¶å•é¡Œçš„åœ–ç‰‡åˆ†æ

**æ¸¬è©¦æ­¥é©Ÿ**ï¼š
1. ä¸Šå‚³ä¸€å¼µé£Ÿç‰©ç…§ç‰‡
2. æ·»åŠ æ–‡å­—ï¼šã€Œé€™é“èœæœ‰å“ªäº›é£Ÿæï¼Ÿã€

**é æœŸçµæœ**ï¼š
```
Bot: å¾åœ–ç‰‡ä¸­å¯ä»¥çœ‹åˆ°é€™é“èœåŒ…å«ä»¥ä¸‹é£Ÿæï¼š
1. [é£Ÿæ1]
2. [é£Ÿæ2]
...
```

**é©—è­‰é»**ï¼š
- âœ… Bot èƒ½åŒæ™‚è™•ç†åœ–ç‰‡å’Œæ–‡å­—
- âœ… å›æ‡‰é‡å°å…·é«”å•é¡Œ
- âœ… ç­”æ¡ˆæº–ç¢º

---

### å ´æ™¯ 3: Memory é€£çºŒæ€§æ¸¬è©¦

**æ¸¬è©¦æ­¥é©Ÿ**ï¼š
1. ä¸Šå‚³ä¸€å¼µåœ–ç‰‡
2. Bot å›æ‡‰å¾Œï¼Œç™¼é€ï¼šã€Œå‰›æ‰é‚£å¼µåœ–ç‰‡è£¡æœ‰å¹¾å€‹äººï¼Ÿã€

**é æœŸçµæœ**ï¼š
```
Bot: æ ¹æ“šå‰›æ‰çš„åœ–ç‰‡ï¼Œè£¡é¢æœ‰ [æ•¸é‡] å€‹äºº...
```

**é©—è­‰é»**ï¼š
- âœ… Bot è¨˜å¾—ä¹‹å‰åˆ†æçš„åœ–ç‰‡
- âœ… å¯ä»¥å›ç­”å¾ŒçºŒå•é¡Œ
- âœ… Memory åŠŸèƒ½æ­£å¸¸

---

### å ´æ™¯ 4: å¤šå¼µåœ–ç‰‡ï¼ˆå¦‚æœæ”¯æ´ï¼‰

**æ¸¬è©¦æ­¥é©Ÿ**ï¼š
1. é€£çºŒä¸Šå‚³å¤šå¼µåœ–ç‰‡
2. è§€å¯Ÿ Bot åæ‡‰

**é æœŸçµæœ**ï¼š
- æ¯å¼µåœ–ç‰‡éƒ½èƒ½è¢«è™•ç†
- å›æ‡‰æ¸…æ¥šæ¨™æ˜æ˜¯å“ªå¼µåœ–ç‰‡

---

### å ´æ™¯ 5: OCR æ–‡å­—è­˜åˆ¥

**æ¸¬è©¦æ­¥é©Ÿ**ï¼š
1. ä¸Šå‚³åŒ…å«æ–‡å­—çš„åœ–ç‰‡ï¼ˆå¦‚èœå–®ã€å‘Šç¤ºç‰Œï¼‰
2. å•ï¼šã€Œé€™å¼µåœ–ç‰‡ä¸Šå¯«äº†ä»€éº¼ï¼Ÿã€

**é æœŸçµæœ**ï¼š
```
Bot: åœ–ç‰‡ä¸Šçš„æ–‡å­—å…§å®¹æ˜¯ï¼š
[è­˜åˆ¥å‡ºçš„æ–‡å­—]
```

**é©—è­‰é»**ï¼š
- âœ… èƒ½è­˜åˆ¥åœ–ç‰‡ä¸­çš„æ–‡å­—
- âœ… ä¸­æ–‡è­˜åˆ¥æº–ç¢º
- âœ… è‹±æ–‡è­˜åˆ¥æº–ç¢º

---

## ğŸ” æ—¥èªŒæª¢æŸ¥

### é—œéµæ—¥èªŒä½ç½®

**Receiver Lambda**ï¼š
```bash
aws logs tail /aws/lambda/telegram-lambda-receiver \
  --region us-west-2 --since 5m --follow
```

**æŸ¥æ‰¾**ï¼š
- âœ… `Processing image: [filename]`
- âœ… `Image converted to base64`
- âœ… `attachment_type: photo`

**Processor Lambda**ï¼š
```bash
aws logs tail /aws/lambda/telegram-unified-bot-processor \
  --region us-west-2 --since 5m --follow
```

**æŸ¥æ‰¾**ï¼š
- âœ… `è™•ç†å¤šæ¨¡æ…‹è¨Šæ¯: 1 å¼µåœ–ç‰‡`
- âœ… `æ§‹å»ºå¤šæ¨¡æ…‹å…§å®¹`
- âœ… `å‚³é 1 å¼µåœ–ç‰‡åˆ° Agent`

---

## âš ï¸ å¸¸è¦‹å•é¡Œæ’é™¤

### å•é¡Œ 1: åœ–ç‰‡æœªè¢«è­˜åˆ¥ç‚º photo é¡å‹

**ç—‡ç‹€**ï¼šåœ–ç‰‡è¢«ç•¶ä½œæ–‡ä»¶è™•ç†

**æª¢æŸ¥**ï¼š
```bash
# æŸ¥çœ‹ file_handler.py çš„æ—¥èªŒ
grep "attachment_type" /aws/lambda/telegram-lambda-receiver/logs
```

**è§£æ±º**ï¼šç¢ºèª `_detect_attachment_type()` å‡½æ•¸æ­£å¸¸å·¥ä½œ

---

### å•é¡Œ 2: Base64 è½‰æ›å¤±æ•—

**ç—‡ç‹€**ï¼šæ—¥èªŒé¡¯ç¤º "Failed to read image from S3"

**æª¢æŸ¥**ï¼š
- S3 bucket æ¬Šé™
- åœ–ç‰‡æ˜¯å¦æˆåŠŸä¸Šå‚³åˆ° S3

**è§£æ±º**ï¼š
```bash
# æª¢æŸ¥ S3
aws s3 ls s3://telegram-files-bucket/[chat_id]/[message_id]/
```

---

### å•é¡Œ 3: Agent æœªæ”¶åˆ°åœ–ç‰‡

**ç—‡ç‹€**ï¼šæ²’æœ‰ "æ§‹å»ºå¤šæ¨¡æ…‹å…§å®¹" æ—¥èªŒ

**æª¢æŸ¥**ï¼š
```python
# processor_entry.py æ˜¯å¦æ­£ç¢ºåˆ¤æ–·
if attachment.get('type') == 'photo':
```

---

### å•é¡Œ 4: Claude å›æ‡‰éŒ¯èª¤

**ç—‡ç‹€**ï¼šæ”¶åˆ°éŒ¯èª¤è¨Šæ¯æˆ–ç©ºå›æ‡‰

**å¯èƒ½åŸå› **ï¼š
1. åœ–ç‰‡æ ¼å¼ä¸æ”¯æ´
2. åœ–ç‰‡å¤ªå¤§ï¼ˆ> 5MBï¼‰
3. Base64 ç·¨ç¢¼éŒ¯èª¤

**æª¢æŸ¥**ï¼š
```bash
# æŸ¥çœ‹å®Œæ•´éŒ¯èª¤
aws logs filter-log-events \
  --log-group-name /aws/lambda/telegram-unified-bot-processor \
  --filter-pattern "ERROR" \
  --start-time $(date -u -d '10 minutes ago' +%s)000
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

### é æœŸæ€§èƒ½
- **åœ–ç‰‡è™•ç†æ™‚é–“**ï¼š5-15 ç§’
  - S3 è®€å–ï¼š< 1 ç§’
  - Base64 è½‰æ›ï¼š< 1 ç§’
  - AI åˆ†æï¼š5-30 ç§’

### Token æ¶ˆè€—
- **åŸºæº–**ï¼šæ¯å¼µåœ–ç‰‡ â‰ˆ 1,600 tokens
- **åŠ æ–‡å­—**ï¼š1,600 + æ–‡å­— tokens

### ç›£æ§æŒ‡æ¨™
```bash
# Lambda åŸ·è¡Œæ™‚é–“
aws cloudwatch get-metric-statistics \
  --namespace AWS/Lambda \
  --metric-name Duration \
  --dimensions Name=FunctionName,Value=telegram-unified-bot-processor \
  --start-time $(date -u -d '1 hour ago' +%s) \
  --end-time $(date -u +%s) \
  --period 300 \
  --statistics Average,Maximum
```

---

## âœ… æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### éƒ¨ç½²å‰
- [x] èªæ³•æª¢æŸ¥é€šé
- [ ] SAM validate é€šé
- [ ] SAM build æˆåŠŸ

### éƒ¨ç½²å¾Œ
- [ ] Lambda ç‹€æ…‹ï¼šActive
- [ ] LastUpdateStatus: Successful
- [ ] ç’°å¢ƒè®Šæ•¸æ­£ç¢ºé…ç½®

### åŠŸèƒ½æ¸¬è©¦
- [ ] å ´æ™¯ 1: åŸºç¤åœ–ç‰‡æè¿°
- [ ] å ´æ™¯ 2: å¸¶å•é¡Œçš„åœ–ç‰‡åˆ†æ
- [ ] å ´æ™¯ 3: Memory é€£çºŒæ€§
- [ ] å ´æ™¯ 4: å¤šå¼µåœ–ç‰‡
- [ ] å ´æ™¯ 5: OCR æ–‡å­—è­˜åˆ¥

### æ€§èƒ½æ¸¬è©¦
- [ ] å›æ‡‰æ™‚é–“ < 30 ç§’
- [ ] ç„¡éŒ¯èª¤æ—¥èªŒ
- [ ] Memory ä½¿ç”¨æ­£å¸¸

---

## ğŸ¯ é©—æ”¶æ¨™æº–

åŠŸèƒ½å®Œæˆçš„æ¨™æº–ï¼š

1. âœ… **åŸºç¤åŠŸèƒ½**
   - èƒ½æ¥æ”¶ä¸¦åˆ†æåœ–ç‰‡
   - èƒ½ç”¨ä¸­æ–‡å›ç­”åœ–ç‰‡ç›¸é—œå•é¡Œ

2. âœ… **æ¶æ§‹æ•´åˆ**
   - ä½¿ç”¨ Strands Agent æ¶æ§‹
   - Memory åŠŸèƒ½æ­£å¸¸
   - å¯ä»¥èª¿ç”¨å…¶ä»– Tools

3. âœ… **ç©©å®šæ€§**
   - ç„¡èªæ³•éŒ¯èª¤
   - éŒ¯èª¤è™•ç†å®Œå–„
   - æ—¥èªŒè¨˜éŒ„æ¸…æ™°

4. âœ… **ç”¨æˆ¶é«”é©—**
   - å›æ‡‰é€Ÿåº¦å¯æ¥å—
   - å›æ‡‰å…§å®¹æº–ç¢º
   - ä¸­æ–‡è¡¨é”è‡ªç„¶

---

**æ¸¬è©¦æŒ‡å—ç‰ˆæœ¬**: v1.0  
**å‰µå»ºæ—¥æœŸ**: 2026-01-07  
**é©ç”¨ç¯„åœ**: åœ–ç‰‡åˆ†æåŠŸèƒ½åˆç‰ˆæ¸¬è©¦
